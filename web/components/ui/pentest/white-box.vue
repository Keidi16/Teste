<script setup lang="ts">
import { useAppPentest } from "@stores/app.pentest";
import { z } from "zod";

const usePentest = useAppPentest();
const { handleOptions, handdleOptionExternal } = usePentest;
const _options = computed(() => usePentest.options);

const all_options = ref(false);
const options = ref({
  recognition: false,
  enumeration: false,
  exploration: false,
  post_exploration: false,
  analyze_malware: false,
  analyze_phishing: false,
});

watch(all_options, (value) => {
  if (value) {
    options.value.recognition = true;
    options.value.enumeration = true;
    options.value.exploration = true;
    options.value.post_exploration = true;
    options.value.analyze_malware = true;
    options.value.analyze_phishing = true;
  } else {
    options.value.recognition = false;
    options.value.enumeration = false;
    options.value.exploration = false;
    options.value.post_exploration = false;
    options.value.analyze_malware = false;
    options.value.analyze_phishing = false;
  }
});
</script>

<template>
  <div v-if="_options.selected === 'white box'" class="max-w-sm mx-auto">
    <div class="p-3">
      <form @submit.prevent="" class="flex flex-col gap-2">
        <div
          class="text-sm flex border border-green-900 rounded-md overflow-hidden mb-3"
        >
          <button
            @click="handdleOptionExternal(false)"
            class="w-full py-2 px-3 transition"
            :class="{ 'bg-green-900': !_options.external }"
          >
            Interno
          </button>
          <button
            @click="handdleOptionExternal(true)"
            class="w-full py-2 px-3 transition"
            :class="{ 'bg-green-900': _options.external }"
          >
            Externo
          </button>
        </div>

        <div class="relative mb-3">
          <ui-input
            label
            labelText="Endereço URL ou IP"
            type="text"
            name="address"
            placeholder="www.example.com"
          />
        </div>

        <div v-show="!_options.external" class="relative mb-3">
          <ui-input
            label
            labelText="Porta"
            type="text"
            name="port"
            placeholder="3000"
          />
        </div>

        <div class="mb-3">
          <ui-pentest-options
            label
            labelText="Ações por realizar"
            v-model="options"
          >
            <div class="flex items-center gap-2">
              <input
                type="checkbox"
                id="all"
                v-model="all_options"
                class="relative peer shrink-0 appearance-none w-3 h-3 cursor-pointer border border-neutral-600 rounded-sm bg-neutral-800 checked:bg-green-700 checked:border-0"
              />
              <Icon
                name="heroicons:check-16-solid"
                class="absolute w-3 h-3 opacity-0 pointer-events-none peer-checked:opacity-100"
              />
              <label for="all" class="text-sm cursor-pointer select-none">
                Todas opções
              </label>
            </div>
          </ui-pentest-options>
        </div>

        <div>
          <button
            :disabled="
              !(
                options.exploration ||
                options.enumeration ||
                options.recognition ||
                options.post_exploration ||
                options.analyze_malware ||
                options.analyze_phishing
              )
            "
            class="w-full py-2 text-sm bg-green-800 rounded-md hover:bg-green-700 disabled:bg-neutral-600 disabled:cursor-not-allowed disabled:text-neutral-400"
          >
            Efectuar Pentest
          </button>
        </div>
      </form>
    </div>
  </div>
</template>
