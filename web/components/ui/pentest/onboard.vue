<script setup lang="ts">
import { useAppPentest } from "@stores/app.pentest";
import { z } from "zod";

definePageMeta({
  title: "Penetration",
  middleware: "auth-routes",
});

const usePentest = useAppPentest();
const { handleOptions } = usePentest;
const options = computed(() => usePentest.options);

const validationSchema = z.object({
  url: z
    .string()
    .min(1, "URL/IP é um campo inválido")
    .regex(RegEx.IPv4 || RegEx.IPv6 || RegEx.URL, "URL/IP é um campo inválido"),
});

const form = ref({
  url: "",
});

const { validate, errors, isValid, getError, scrollToError } = useValidator(
  validationSchema,
  form,
  { mode: "eager" }
);

const onSubmit = async () => {
  await validate();

  if (isValid.value) {
    alert("Validation successful");
  } else {
    console.log(getError("url"));
  }
};
</script>

<template>
  <div v-if="options.step === 2" class="">
    <span class="py-3 h-10 flex items-center">
      <span
        @click="handleOptions({ step: 1, selected: undefined })"
        class="block text-sm text-white/50 cursor-pointer transition hover:text-green-600"
      >
        <Icon name="heroicons:chevron-left" class="mr-1" />
        Escolher o tipo de Pentest
      </span>
    </span>

    <div class="mt-6 p-2">
      <h3 class="text-lg text-center font-semibold uppercase mb-4">
        Detalhes sobre o pentest
      </h3>
      <ui-pentest-black-box />
      <ui-pentest-white-box />
    </div>
  </div>
</template>
